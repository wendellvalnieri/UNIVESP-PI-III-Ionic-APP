<!-- src/app/pages/agendamentos/agendamento-form/agendamento-form.component.html -->
<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-button (click)="cancelar()">
        <ion-icon slot="icon-only" name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>{{ modo === 'criar' ? 'Novo Agendamento' : 'Editar Agendamento' }}</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="salvar()">
        <ion-icon slot="icon-only" name="checkmark"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <form [formGroup]="agendamentoForm">
    <ion-list>
      <ion-item>
        <ion-label position="floating">Cliente</ion-label>
        <ion-select formControlName="clienteId" interface="action-sheet" cancelText="Cancelar">
          <ion-select-option *ngFor="let cliente of clientes" [value]="cliente.id">
            {{ cliente.nome }}
          </ion-select-option>
        </ion-select>
      </ion-item>
      <ion-item *ngIf="agendamentoForm.get('clienteId').invalid && agendamentoForm.get('clienteId').touched">
        <ion-text color="danger">Selecione um cliente</ion-text>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Serviço</ion-label>
        <ion-select formControlName="servicoId" interface="action-sheet" cancelText="Cancelar">
          <ion-select-option *ngFor="let servico of servicos" [value]="servico.id">
            {{ servico.nome }} - R$ {{ servico.preco.toFixed(2) }}
          </ion-select-option>
        </ion-select>
      </ion-item>
      <ion-item *ngIf="agendamentoForm.get('servicoId').invalid && agendamentoForm.get('servicoId').touched">
        <ion-text color="danger">Selecione um serviço</ion-text>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Data</ion-label>
        <ion-datetime formControlName="data" displayFormat="DD/MM/YYYY" min="{{ new Date().toISOString() }}"
          cancelText="Cancelar" doneText="Selecionar"></ion-datetime>
      </ion-item>
      <ion-item *ngIf="agendamentoForm.get('data').invalid && agendamentoForm.get('data').touched">
        <ion-text color="danger">Selecione uma data</ion-text>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Horário</ion-label>
        <ion-select formControlName="horario" interface="action-sheet" cancelText="Cancelar">
          <ion-select-option *ngFor="let hora of horarios" [value]="hora">
            {{ hora }}
          </ion-select-option>
        </ion-select>
      </ion-item>
      <ion-item *ngIf="agendamentoForm.get('horario').invalid && agendamentoForm.get('horario').touched">
        <ion-text color="danger">Selecione um horário</ion-text>
      </ion-item>

      <ion-item>
        <ion-label position="floating">Observações</ion-label>
        <ion-textarea formControlName="observacoes" rows="3"
          placeholder="Alguma observação específica? (opcional)"></ion-textarea>
      </ion-item>
    </ion-list>

    <ion-card *ngIf="agendamentoForm.get('servicoId').value">
      <ion-card-header>
        <ion-card-subtitle>Resumo do agendamento</ion-card-subtitle>
      </ion-card-header>
      <ion-card-content>
        <ion-list lines="none">
          <ion-item>
            <ion-label>
              <h2>Serviço</h2>
              <p *ngIf="agendamentoForm.get('servicoId').value">
                {{ (servicos.find(s => s.id === +agendamentoForm.get('servicoId').value))?.nome }}
              </p>
            </ion-label>
          </ion-item>

          <ion-item>
            <ion-label>
              <h2>Cliente</h2>
              <p *ngIf="agendamentoForm.get('clienteId').value">
                {{ (clientes.find(c => c.id === +agendamentoForm.get('clienteId').value))?.nome }}
              </p>
            </ion-label>
          </ion-item>

          <ion-item>
            <ion-label>
              <h2>Data e Hora</h2>
              <p *ngIf="agendamentoForm.get('data').value && agendamentoForm.get('horario').value">
                {{ agendamentoForm.get('data').value | date:'dd/MM/yyyy' }} às {{ agendamentoForm.get('horario').value
                }}
              </p>
            </ion-label>
          </ion-item>

          <ion-item>
            <ion-label>
              <h2>Valor</h2>
              <p *ngIf="agendamentoForm.get('servicoId').value">
                R$ {{ getServicoPreco(+agendamentoForm.get('servicoId').value).toFixed(2) }}
              </p>
            </ion-label>
          </ion-item>
        </ion-list>
      </ion-card-content>
    </ion-card>
  </form>
</ion-content>

<ion-footer>
  <ion-toolbar>
    <ion-button expand="block" (click)="salvar()" [disabled]="agendamentoForm.invalid">
      {{ modo === 'criar' ? 'Criar Agendamento' : 'Atualizar Agendamento' }}
    </ion-button>
  </ion-toolbar>
</ion-footer>